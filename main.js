"use strict";(()=>{var qt=Object.defineProperty;var Yt=(t,e)=>{for(var n in e)qt(t,n,{get:e[n],enumerable:!0})};var ot=t=>typeof t=="object"?t.handle.bind(t):t,We=({service:t,fetch:e=fetch})=>async(n,s)=>{let r=new URL(n,t);return await e(r,s)};var it=/\bapplication\/json\b/,ae=class t{constructor({handler:e,proxy:n=null}){this.handler=ot(e),this.proxy=n}clone({handler:e=this.handler,proxy:n=this.proxy}={}){return new t({handler:e,proxy:n})}get(e,n={}){return this.#e("get",e,n)}post(e,n={}){return this.#e("post",e,n)}async#e(e,n,{signal:s,as:r="json",headers:o,input:i,params:a}){let p=i&&(i instanceof Blob||ArrayBuffer.isView(i)||i instanceof ArrayBuffer||i instanceof ReadableStream),c=`/xrpc/${n}`+Qt(a),d=await this.handler(c,{method:e,signal:s,body:i&&!p?JSON.stringify(i):i,headers:tn(o,{"content-type":i&&!p?"application/json":null,"atproto-proxy":en(this.proxy)})});{let l=d.status,h=d.headers,f=h.get("content-type");if(l!==200){let u;if(f!=null&&it.test(f))try{let m=await d.json();at(m)&&(u=m)}catch{}else await d.body?.cancel();return{ok:!1,status:l,headers:h,data:u??{error:"UnknownXRPCError",message:`Request failed with status code ${l}`}}}{let u;switch(r){case"json":{if(f!=null&&it.test(f))u=await d.json();else throw await d.body?.cancel(),new TypeError(`Invalid response content-type (got ${f})`);break}case null:{if(u=null,await d.body?.cancel(),f!=null)throw new TypeError(`Invalid response content-type (got ${f})`);break}case"blob":{u=await d.blob();break}case"bytes":{u=new Uint8Array(await d.arrayBuffer());break}case"stream":{u=d.body;break}}return{ok:!0,status:l,headers:h,data:u}}}}},Qt=t=>{let e;for(let n in t){let s=t[n];if(s!==void 0)if(e??=new URLSearchParams,Array.isArray(s))for(let r=0,o=s.length;r<o;r++){let i=s[r];e.append(n,""+i)}else e.set(n,""+s)}return e?"?"+e.toString():""},en=t=>t!=null?`${t.did}${t.serviceId}`:null,tn=(t,e)=>{let n;for(let s in e){let r=e[s];r!==null&&(n??=new Headers(t),n.has(s)||n.set(s,r))}return n??t},at=t=>{if(typeof t!="object"||t==null)return!1;let e=typeof t.error,n=typeof t.message;return e==="string"&&(n==="undefined"||n==="string")},ge=t=>{if(t instanceof Promise)return t.then(ge);if(t.ok)return t.data;throw new we(t)},we=class extends Error{constructor({status:e,headers:n=new Headers,data:s}){super(`${s.error} > ${s.message??"(unspecified description)"}`),this.name="ClientResponseError",this.error=s.error,this.description=s.message,this.status=e,this.headers=n}};var Re={};Yt(Re,{FRAGMENT_RE:()=>Ot,MULTIBASE_RE:()=>Ht,didDocument:()=>vn,didRelativeUri:()=>Le,didString:()=>ue,multibaseString:()=>zt,rfc3968UriSchema:()=>j,service:()=>Ft,verificationMethod:()=>tt});function I(t){return{ok:!1,code:"invalid_type",expected:t}}var lt=I([]),ut=I(["string"]),ht=I(["number"]),nn=I(["bigint"]),pt=I(["boolean"]),ft=I(["undefined"]),mt=I(["null"]),sn=I(["object"]),rn=I(["array"]),Qe={ok:!1,code:"missing_value"};function B(t,e){return t?{ok:!1,code:"join",left:t,right:e}:e}function J(t,e){return{ok:!1,code:"prepend",key:t,tree:e}}function on(t,e){var n;let s=t.code;switch(s){case"invalid_type":return{code:s,path:e,expected:t.expected};case"invalid_literal":return{code:s,path:e,expected:t.expected};case"missing_value":return{code:s,path:e};case"invalid_length":return{code:s,path:e,minLength:t.minLength,maxLength:t.maxLength};case"unrecognized_keys":return{code:s,path:e,keys:t.keys};case"invalid_union":return{code:s,path:e,tree:t.tree,issues:ke(t.tree)};case"custom_error":return typeof t.error=="object"&&t.error.path!==void 0&&e.push(...t.error.path),{code:s,path:e,message:typeof t.error=="string"?t.error:(n=t.error)===null||n===void 0?void 0:n.message,error:t.error}}}function ke(t,e=[],n=[]){for(;;)if(t.code==="join")ke(t.left,e.slice(),n),t=t.right;else if(t.code==="prepend")e.push(t.key),t=t.tree;else return n.push(on(t,e)),n}function Xe(t,e){return t.length===0?"nothing":t.length===1?t[0]:`${t.slice(0,-1).join(", ")} ${e} ${t[t.length-1]}`}function ct(t){return typeof t=="bigint"?`${t}n`:JSON.stringify(t)}function wt(t){let e=0;for(;;)if(t.code==="join")e+=wt(t.left),t=t.right;else if(t.code==="prepend")t=t.tree;else return e+1}function gt(t){let e="",n=0;for(;;)if(t.code==="join")n+=wt(t.right),t=t.left;else if(t.code==="prepend")e+=`.${t.key}`,t=t.tree;else break;let s="validation failed";if(t.code==="invalid_type")s=`expected ${Xe(t.expected,"or")}`;else if(t.code==="invalid_literal")s=`expected ${Xe(t.expected.map(ct),"or")}`;else if(t.code==="missing_value")s="missing value";else if(t.code==="unrecognized_keys"){let o=t.keys;s=`unrecognized ${o.length===1?"key":"keys"} ${Xe(o.map(ct),"and")}`}else if(t.code==="invalid_length"){let o=t.minLength,i=t.maxLength;s="expected an array with ",o>0?i===o?s+=`${o}`:i!==void 0?s+=`between ${o} and ${i}`:s+=`at least ${o}`:s+=`at most ${i??"\u221E"}`,s+=" item(s)"}else if(t.code==="custom_error"){let o=t.error;typeof o=="string"?s=o:o!==void 0&&(o.message!==void 0&&(s=o.message),o.path!==void 0&&(e+="."+o.path.join(".")))}let r=`${t.code} at .${e.slice(1)} (${s})`;return n===1?r+=" (+ 1 other issue)":n>1&&(r+=` (+ ${n} other issues)`),r}function T(t,e,n,s){return Object.defineProperty(t,e,{value:n,enumerable:s,writable:!1}),n}var ye=class extends Error{constructor(e){super(gt(e)),Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name,this._issueTree=e}get issues(){return T(this,"issues",ke(this._issueTree),!0)}},xe=class{constructor(e){this.ok=!1,this._issueTree=e}get issues(){return T(this,"issues",ke(this._issueTree),!0)}get message(){return T(this,"message",gt(this._issueTree),!0)}throw(){throw new ye(this._issueTree)}};function D(t){return{ok:!0,value:t}}function G(t){return new xe({ok:!1,code:"custom_error",error:t})}function yt(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var $=1,le=2,Te=4,xt=0,an=1,vt=2,_t=3,cn=4,Et=5,bt=6,kt=7,Tt=8,At=9,Lt=10,Rt=11,St=12,It=13,Dt=14,dn=15,L=(t,e)=>({tag:t,match:e});function E(t,e,n){switch(t.tag){case xt:return;case an:return lt;case vt:return typeof e=="string"?void 0:ut;case _t:return typeof e=="number"?void 0:ht;case cn:return typeof e=="bigint"?void 0:nn;case Et:return typeof e=="boolean"?void 0:pt;case bt:return e===null?void 0:mt;case kt:return e===void 0?void 0:ft;case Tt:return t.match(e,n);case At:return t.match(e,n);case Lt:return t.match(e,n);case Rt:return t.match(e,n);case St:return t.match(e,n);case It:return t.match(e,n);case Dt:return t.match(e,n);default:return t.match(e,n)}}var w=Symbol.for("@valita/internal"),ve=class{default(e){let n=D(e);return new A(this.optional(),s=>s===void 0?n:void 0)}assert(e,n){let s={ok:!1,code:"custom_error",error:n};return new A(this,(r,o)=>e(r,Ke(o))?void 0:s)}map(e){return new A(this,(n,s)=>({ok:!0,value:e(n,Ke(s))}))}chain(e){return typeof e=="function"?new A(this,(n,s)=>{let r=e(n,Ke(s));return r.ok?r:r._issueTree}):new A(this,(n,s)=>E(e[w],n,s))}},R=class extends ve{optional(e){let n=new Ze(this);return e?new A(n,s=>s===void 0?{ok:!0,value:e()}:void 0):n}nullable(e){let n=new Ve([gn(),this]);return e?new A(n,s=>s===null?{ok:!0,value:e()}:void 0):n}_toTerminals(e){e(this)}try(e,n){let s=E(this[w],e,n===void 0?$:n.mode==="strip"?le:n.mode==="passthrough"?0:$);return s===void 0||s.ok?{ok:!0,value:s===void 0?e:s.value}:new xe(s)}parse(e,n){let s=E(this[w],e,n===void 0?$:n.mode==="strip"?le:n.mode==="passthrough"?0:$);if(s===void 0||s.ok)return s===void 0?e:s.value;throw new ye(s)}},Ve=class extends R{constructor(e){super(),this.name="union",this.options=e}get[w](){let e=this.options.map(n=>n[w]);return T(this,w,L(It,(n,s)=>{let r=lt;for(let o of e){let i=E(o,n,s);if(i===void 0||i.ok)return i;r=i}return r}),!1)}_toTerminals(e){for(let n of this.options)n._toTerminals(e)}},Ze=class extends ve{constructor(e){super(),this.name="optional",this.type=e}optional(e){return e?new A(this,n=>n===void 0?{ok:!0,value:e()}:void 0):this}get[w](){let e=this.type[w];return T(this,w,L(At,(n,s)=>n===void 0||s&Te?void 0:E(e,n,s)),!1)}_toTerminals(e){e(this),e(yn()),this.type._toTerminals(e)}};function Ut(t,e){if(typeof t!="number"){let n=e>>5;for(let s=t.length;s<=n;s++)t.push(0);return t[n]|=1<<e%32,t}else return e<32?t|1<<e:Ut([t,0],e)}function ce(t,e){return typeof t=="number"?e<32?t>>>e&1:0:t[e>>5]>>>e%32&1}var _e=class t extends R{constructor(e,n,s){super(),this.name="object",this.shape=e,this._restType=n,this._checks=s}get[w](){let e=ln(this.shape,this._restType,this._checks);return T(this,w,L(Lt,(n,s)=>yt(n)?e(n,s):sn),!1)}check(e,n){var s;let r={ok:!1,code:"custom_error",error:n};return new t(this.shape,this._restType,[...(s=this._checks)!==null&&s!==void 0?s:[],{func:e,issue:r}])}rest(e){return new t(this.shape,e)}extend(e){return new t(Object.assign(Object.assign({},this.shape),e),this._restType)}pick(...e){let n={};for(let s of e)b(n,s,this.shape[s]);return new t(n,void 0)}omit(...e){let n=Object.assign({},this.shape);for(let s of e)delete n[s];return new t(n,this._restType)}partial(){var e;let n={};for(let r of Object.keys(this.shape))b(n,r,this.shape[r].optional());let s=(e=this._restType)===null||e===void 0?void 0:e.optional();return new t(n,s)}};function b(t,e,n){e==="__proto__"?Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0}):t[e]=n}function ln(t,e,n){let s=Object.keys(t).map((a,p)=>{let c=t[a],d=!1;return c._toTerminals(l=>{d||(d=l.name==="optional")}),{key:a,index:p,matcher:c[w],optional:d,missing:J(a,Qe)}}),r=Object.create(null);for(let a of s)r[a.key]=a;let o=e?.[w],i=s.length===0&&e?.name==="unknown"&&n===void 0;return(a,p)=>{if(i)return;let c,d,l,h=0,f=0;if(p&($|le)||o!==void 0)for(let u in a){let m=a[u],g=r[u];if(g===void 0&&o===void 0){if(p&$)l===void 0?(l=[u],d=B(d,{ok:!1,code:"unrecognized_keys",keys:l})):l.push(u);else if(p&le&&d===void 0&&c===void 0){c={};for(let y=0;y<s.length;y++)if(ce(h,y)){let x=s[y].key;b(c,x,a[x])}}continue}let v=E(g===void 0?o:g.matcher,m,p);if(v===void 0)c!==void 0&&d===void 0&&b(c,u,m);else if(!v.ok)d=B(d,J(u,v));else if(d===void 0){if(c===void 0)if(c={},o===void 0){for(let y=0;y<s.length;y++)if(ce(h,y)){let x=s[y].key;b(c,x,a[x])}}else for(let y in a)b(c,y,a[y]);b(c,u,v.value)}g!==void 0&&(f++,h=Ut(h,g.index))}if(f<s.length)for(let u=0;u<s.length;u++){if(ce(h,u))continue;let m=s[u],g=a[m.key],v=0;if(g===void 0&&!(m.key in a)){if(!m.optional){d=B(d,m.missing);continue}v=Te}let y=E(m.matcher,g,p|v);if(y===void 0)c!==void 0&&d===void 0&&!v&&b(c,m.key,g);else if(!y.ok)d=B(d,J(m.key,y));else if(d===void 0){if(c===void 0)if(c={},o===void 0){for(let x=0;x<s.length;x++)if(x<u||ce(h,x)){let ie=s[x].key;b(c,ie,a[ie])}}else{for(let x in a)b(c,x,a[x]);for(let x=0;x<u;x++)if(!ce(h,x)){let ie=s[x].key;b(c,ie,a[ie])}}b(c,m.key,y.value)}}if(d!==void 0)return d;if(n!==void 0){for(let{func:u,issue:m}of n)if(!u(c??a))return m}return c&&{ok:!0,value:c}}}var Ee=class t extends R{constructor(e,n,s){super(),this.name="array",this._prefix=e,this._rest=n,this._suffix=s}get[w](){var e,n;let s=this._prefix.map(c=>c[w]),r=this._suffix.map(c=>c[w]),o=(n=(e=this._rest)===null||e===void 0?void 0:e[w])!==null&&n!==void 0?n:L(1,()=>Qe),i=s.length+r.length,a=this._rest?1/0:i,p={ok:!1,code:"invalid_length",minLength:i,maxLength:a===1/0?void 0:a};return T(this,w,L(Rt,(c,d)=>{if(!Array.isArray(c))return rn;let l=c.length;if(l<i||l>a)return p;let h=s.length,f=c.length-r.length,u,m=c;for(let g=0;g<c.length;g++){let v=g<h?s[g]:g>=f?r[g-f]:o,y=E(v,c[g],d);y!==void 0&&(y.ok?(m===c&&(m=c.slice()),m[g]=y.value):u=B(u,J(g,y)))}return u||(c===m?void 0:{ok:!0,value:m})}),!1)}concat(e){if(this._rest){if(e._rest)throw new TypeError("can not concatenate two variadic types");return new t(this._prefix,this._rest,[...this._suffix,...e._prefix,...e._suffix])}else return e._rest?new t([...this._prefix,...this._suffix,...e._prefix],e._rest,e._suffix):new t([...this._prefix,...this._suffix,...e._prefix,...e._suffix],e._rest,e._suffix)}};function be(t){let e=typeof t;return e!=="object"?e:t===null?"null":Array.isArray(t)?"array":e}function de(t){return[...new Set(t)]}function Ct(t){var e,n,s;let r=new Map,o=new Map,i=new Map,a=[],p=[],c=[];for(let{root:l,terminal:h}of t)if(r.set(l,(e=r.get(l))!==null&&e!==void 0?e:r.size),h.name!=="never")if(h.name==="optional")p.push(l);else if(h.name==="unknown")a.push(l);else if(h.name==="literal"){let f=(n=o.get(h.value))!==null&&n!==void 0?n:[];f.push(l),o.set(h.value,f),c.push(be(h.value))}else{let f=(s=i.get(h.name))!==null&&s!==void 0?s:[];f.push(l),i.set(h.name,f),c.push(h.name)}let d=(l,h)=>{var f,u;return((f=r.get(l))!==null&&f!==void 0?f:0)-((u=r.get(h))!==null&&u!==void 0?u:0)};for(let[l,h]of o){let f=i.get(be(l));f?(f.push(...h),o.delete(l)):o.set(l,de(h.concat(a)).sort(d))}for(let[l,h]of i)i.set(l,de(h.concat(a)).sort(d));return{types:i,literals:o,unknowns:de(a).sort(d),optionals:de(p).sort(d),expectedTypes:de(c)}}function un(t,e){var n;let s=[];for(let{root:u,terminal:m}of t)m.shape[e]._toTerminals(g=>s.push({root:u,terminal:g}));let{types:r,literals:o,optionals:i,unknowns:a,expectedTypes:p}=Ct(s);if(a.length>0||i.length>1)return;for(let u of o.values())if(u.length>1)return;for(let u of r.values())if(u.length>1)return;let c=J(e,Qe),d=J(e,r.size===0?{ok:!1,code:"invalid_literal",expected:[...o.keys()]}:{ok:!1,code:"invalid_type",expected:p}),l=o.size>0?new Map:void 0;if(l)for(let[u,m]of o)l.set(u,m[0][w]);let h=r.size>0?{}:void 0;if(h)for(let[u,m]of r)h[u]=m[0][w];let f=(n=i[0])===null||n===void 0?void 0:n[w];return(u,m)=>{var g;let v=u[e];if(v===void 0&&!(e in u))return f===void 0?c:E(f,u,m);let y=(g=h?.[be(v)])!==null&&g!==void 0?g:l?.get(v);return y?E(y,u,m):d}}function hn(t){var e;let n=[],s=new Map;for(let{root:r,terminal:o}of t){if(o.name==="unknown")return;if(o.name==="object"){for(let i in o.shape)s.set(i,((e=s.get(i))!==null&&e!==void 0?e:0)+1);n.push({root:r,terminal:o})}}if(!(n.length<2)){for(let[r,o]of s)if(o===n.length){let i=un(n,r);if(i)return i}}}function pn(t){let{expectedTypes:e,literals:n,types:s,unknowns:r,optionals:o}=Ct(t),i=s.size===0&&r.length===0?{ok:!1,code:"invalid_literal",expected:[...n.keys()]}:{ok:!1,code:"invalid_type",expected:e},a=n.size>0?new Map:void 0;if(a)for(let[l,h]of n)a.set(l,h.map(f=>f[w]));let p=s.size>0?{}:void 0;if(p)for(let[l,h]of s)p[l]=h.map(f=>f[w]);let c=o.map(l=>l[w]),d=r.map(l=>l[w]);return(l,h)=>{var f,u;let m=h&Te?c:(u=(f=p?.[be(l)])!==null&&f!==void 0?f:a?.get(l))!==null&&u!==void 0?u:d,g=0,v=i;for(let y=0;y<m.length;y++){let x=E(m[y],l,h);if(x===void 0||x.ok)return x;v=g>0?B(v,x):x,g++}return g>1?{ok:!1,code:"invalid_union",tree:v}:v}}var qe=class extends R{constructor(e){super(),this.name="union",this.options=e}_toTerminals(e){for(let n of this.options)n._toTerminals(e)}get[w](){let e=[];for(let r of this.options)r._toTerminals(o=>{e.push({root:r,terminal:o})});let n=pn(e),s=hn(e);return T(this,w,L(St,(r,o)=>s!==void 0&&yt(r)?s(r,o):n(r,o)),!1)}},fn=Object.freeze({mode:"strict"}),mn=Object.freeze({mode:"strip"}),wn=Object.freeze({mode:"passthrough"});function Ke(t){return t&$?fn:t&le?mn:wn}var A=class t extends R{constructor(e,n){super(),this.name="transform",this._transformed=e,this._transform=n}get[w](){let e=[],n=this;for(;n instanceof t;)e.push(n._transform),n=n._transformed;e.reverse();let s=n[w],r=D(void 0);return T(this,w,L(Dt,(o,i)=>{let a=E(s,o,i);if(a!==void 0&&!a.ok)return a;let p;a!==void 0?p=a.value:i&Te?(p=void 0,a=r):p=o;for(let c=0;c<e.length;c++){let d=e[c](p,i);if(d!==void 0){if(!d.ok)return d;p=d.value,a=d}}return a}),!1)}_toTerminals(e){this._transformed._toTerminals(e)}},dt=class extends R{constructor(e){super(),this.name="lazy",this._recursing=!1,this._definer=e}get type(){return T(this,"type",this._definer(),!0)}get[w](){let e=L(dn,(n,s)=>{let r=this.type[w];return e.tag=r.tag,e.match=r.match,T(this,w,r,!1),E(r,n,s)});return e}_toTerminals(e){if(!this._recursing){this._recursing=!0;try{this.type._toTerminals(e)}finally{this._recursing=!1}}}};function W(t,e,n){let s=L(e,n);class r extends R{constructor(){super(),this.name=t,this[w]=s}}let o=new r;return()=>o}var $t=W("unknown",xt,()=>{});var _=W("string",vt,t=>typeof t=="string"?void 0:ut),jt=W("number",_t,t=>typeof t=="number"?void 0:ht);var X=W("boolean",Et,t=>typeof t=="boolean"?void 0:pt),gn=W("null",bt,t=>t===null?void 0:mt);var yn=W("undefined",kt,t=>t===void 0?void 0:ft);var Ye=class extends R{constructor(e){super(),this.name="literal";let n={ok:!1,code:"invalid_literal",expected:[e]};this[w]=L(Tt,s=>s===e?void 0:n),this.value=e}},et=t=>new Ye(t),U=t=>new _e(t,void 0),Ae=t=>new _e({},t??$t()),k=t=>new Ee([],t??$t(),[]),Mt=t=>new Ee(t,void 0,[]),K=(...t)=>new qe(t);var xn=/^did:([a-z]+):([a-zA-Z0-9._:%\-]*[a-zA-Z0-9._\-])$/,Pt=t=>typeof t=="string"&&t.length>=7&&t.length<=2048&&xn.test(t);var Ot=/^#[^#]+$/,Ht=/^z[a-km-zA-HJ-NP-Z1-9]+$/,j=_().assert(t=>URL.canParse(t),"must be a url"),Le=_().assert(t=>Ot.test(t)||URL.canParse(t),"must be a did relative uri"),zt=_().assert(t=>Ht.test(t),"must be a base58 multibase"),ue=_().assert(Pt,"must be a did"),tt=U({id:Le,type:_(),controller:ue,publicKeyMultibase:zt.optional(),publicKeyJwk:Ae().optional()}).chain(t=>{switch(t.type){case"Multikey":{if(t.publicKeyMultibase===void 0)return G({message:"missing multikey",path:["publicKeyMultibase"]});break}case"EcdsaSecp256k1VerificationKey2019":case"EcdsaSecp256r1VerificationKey2019":{if(t.publicKeyMultibase===void 0)return G({message:"missing multibase key",path:["publicKeyMultibase"]});break}}return D(t)}),Ft=U({id:Le,type:K(_(),k(_())),serviceEndpoint:K(j,Ae(j),k(K(j,Ae(j))))}),vn=U({"@context":k(j),id:ue,alsoKnownAs:k(j).chain(t=>{for(let e=0,n=t.length;e<n;e++){let s=t[e];for(let r=0;r<e;r++)if(s===t[r])return G({message:`duplicate "${s}" aka entry`,path:[e]})}return D(t)}).optional(),verificationMethod:k(tt).chain(t=>{for(let e=0,n=t.length;e<n;e++){let r=t[e].id;for(let o=0;o<e;o++)if(r===t[o].id)return G({message:`duplicate "${r}" verification method`,path:[e,"id"]})}return D(t)}).optional(),service:k(Ft).optional(),controller:K(ue,k(ue)).optional(),authentication:k(K(Le,tt)).optional()}).chain(t=>{let{id:e,service:n}=t;if(n?.length){let s=n.length,r=new Array(s);for(let o=0;o<s;o++){let a=n[o].id;a[0]==="#"&&(a=e+a),r[o]=a}for(let o=0;o<s;o++){let i=r[o];for(let a=0;a<o;a++)if(i===r[a])return G({message:`duplicate "${i}" service`,path:["service",o,"id"]})}}return D(t)});var _n=/^did:plc:([a-z2-7]{24})$/,Bt=t=>t.length===32&&_n.test(t);var En=/^did:web:([a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*(?:\.[a-zA-Z]{2,})|localhost(?:%3[aA]\d+)?)$/;var Jt=t=>t.length>=12&&En.test(t);var Gt=t=>{let[e,...n]=t.slice(8).split(":").map(decodeURIComponent),s="/"+n.join("/");s==="/"?s="/.well-known/did.json":s+="/did.json";let r=new URL(`https://${e}${s}`);return r.hostname==="localhost"&&(r.protocol="http:"),r};var Se=t=>Bt(t)||Jt(t),Wt=t=>{let e=t.indexOf(":",4);return t.slice(4,e)};var bn=0,M=class{constructor(e){this.children=[];this.id="L"+bn++;this.wraps=e,this.wraps.id=this.id}add(e){if(e!=null){let n;typeof e=="string"?n=new Z(e):n=e,this.children.push(n),this.wraps.appendChild(n.wraps)}else throw new Error("node undefined");return this}remove(e){let n=this.children.indexOf(e);if(n<0)throw new Error("node not a child of this node");this.children.splice(n,1),this.wraps.removeChild(e.wraps)}with(...e){return e.forEach(n=>{this.add(n)}),this}style(e){return e(this.wraps.style),this}class(e){return this.wraps.classList.add(e),this}};var N=class extends M{constructor(){let e=document.createElement("div");e.classList.add("LContainer"),super(e)}},P=class extends N{constructor(){super(),this.wraps.classList.add("LColumn")}},V=class extends N{constructor(){super(),this.wraps.classList.add("LRow")}};var he=class extends M{constructor(){super(...arguments);this._text=""}get text(){return this._text}set text(n){this._text=n,this.wraps.textContent=n}},Z=class extends he{constructor(e=""){let n=document.createElement("span");n.classList.add("LLabel"),super(n),this.text=e}},O=class extends he{constructor(e,n){let s=document.createElement("button");s.textContent=e,s.addEventListener("click",n),s.classList.add("LButton"),super(s),this.text=e}},pe=class extends he{constructor(n="text"){let s=document.createElement("input");s.type=n,s.classList.add("LInput");super(s);this.watching=[]}set placeholder(n){this.wraps.placeholder=n}get value(){return this.wraps.value}set value(n){this.wraps.value=n,this.watching.forEach(s=>s(n))}watch(n){this.watching.push(n),this.wraps.oninput=s=>{n(this.value)},n(this.value)}},Ie=class extends M{constructor(e){let n=document.createElement("img");n.src=e,n.classList.add("LImage"),super(n)}},De=class extends M{constructor(){let e=document.createElement("dialog");e.classList.add("LModal"),super(e)}show(){Ue.add(this),this.wraps.showModal()}hide(){this.wraps.close(),Ue.wraps.removeChild(this.wraps)}},Ue=new M(document.body);var fe=class extends Error{name="DidResolutionError"},C=class extends fe{did;name="UnsupportedDidMethodError";constructor(e){super(`unsupported did method; did=${e}`),this.did=e}};var q=class extends fe{did;name="DocumentNotFoundError";constructor(e){super(`did document not found; did=${e}`),this.did=e}},Y=class extends fe{did;name="FailedDocumentResolutionError";constructor(e,n){super(`failed to resolve did document; did=${e}`,n),this.did=e}},Q=class extends Error{name="HandleResolutionError"},H=class extends Q{handle;name="DidNotFoundError";constructor(e){super(`handle returned no did; handle=${e}`),this.handle=e}},z=class extends Q{handle;name="FailedHandleResolutionError";constructor(e,n){super(`failed to resolve handle; handle=${e}`,n),this.handle=e}},ee=class extends Q{handle;did;name="InvalidResolvedHandleError";constructor(e,n){super(`handle returned invalid did; handle=${e}; did=${n}`),this.handle=e,this.did=n}},te=class extends Q{name="AmbiguousHandleError";constructor(e){super(`handle returned multiple did values; handle=${e}`)}};var Ce=class{#e;constructor({methods:e}){this.#e=new Map(Object.entries(e))}async resolve(e,n){let s=Wt(e),r=this.#e.get(s);if(r===void 0)throw new C(e);return await r.resolve(e,n)}};var se=class extends Error{name="FetchResponseError"},S=class extends se{status;name="FailedResponseError";constructor(e,n){super(n),this.status=e}},me=class extends se{contentType;name="ImproperContentTypeError";constructor(e,n){super(n),this.contentType=e}},F=class extends se{expectedSize;actualSize;name="ImproperContentLengthError";constructor(e,n,s){super(s),this.expectedSize=e,this.actualSize=n}},$e=class extends se{name="ImproperResponseError";constructor(e,n){super(e,n)}};function re(...t){return t.reduce(kn)}var kn=(t,e)=>n=>t(n).then(e);var je=class extends TransformStream{constructor(e){let n=0;super({transform(s,r){if(n+=s.length,n>e){r.error(new F(e,n,"response content-length too large"));return}r.enqueue(s)}})}};var oe=async t=>{if(t.ok)return t;throw t.body&&await t.body.cancel(),new S(t.status,`got http ${t.status}`)},Kt=t=>async e=>{let n=await Vt(e,t);return{response:e,text:n}},Me=(t,e)=>async n=>{Tn(n,t);let s=await Vt(n,e);try{let r=JSON.parse(s);return{response:n,json:r}}catch(r){throw new $e("unexpected json data",{cause:r})}},Ne=(t,e)=>async n=>{let s=t.parse(n.json,e);return{response:n.response,json:s}},Tn=async(t,e)=>{let n=t.headers.get("content-type")?.split(";",1)[0].trim();if(n===void 0)throw t.body&&await t.body.cancel(),new me(null,"missing response content-type");if(!e.test(n))throw t.body&&await t.body.cancel(),new me(n,"unexpected response content-type")},Vt=async(t,e)=>{let n=t.headers.get("content-length");if(n!==null){let o=Number(n);if(!Number.isSafeInteger(o)||o<=0)throw t.body?.cancel(),new F(e,null,"invalid response content-length");if(o>e)throw t.body?.cancel(),new F(e,o,"response content-length too large")}let s=t.body.pipeThrough(new je(e)).pipeThrough(new TextDecoderStream),r="";for await(let o of An(s))r+=o;return r},An=Symbol.asyncIterator in ReadableStream.prototype?t=>t[Symbol.asyncIterator]():t=>{let e=t.getReader();return{[Symbol.asyncIterator](){return this},next(){return e.read()},async return(){return await e.cancel(),{done:!0,value:void 0}},async throw(n){return await e.cancel(n),{done:!0,value:void 0}}}};var Pe=re(oe,Me(/^application\/(did\+ld\+)?json$/,20*1024),Ne(Re.didDocument,{mode:"passthrough"}));var Oe=class{apiUrl;#e;constructor({apiUrl:e="https://plc.directory",fetch:n=fetch}={}){this.apiUrl=e,this.#e=n}async resolve(e,n){if(!e.startsWith("did:plc:"))throw new C(e);let s;try{let r=new URL(`/${encodeURIComponent(e)}`,this.apiUrl),o=await(0,this.#e)(r,{signal:n?.signal,cache:n?.noCache?"no-cache":void 0,redirect:"manual",headers:{accept:"application/did+ld+json,application/json"}});if(o.status>=300&&o.status<400)throw new TypeError("unexpected redirect");s=(await Pe(o)).json}catch(r){throw r instanceof S&&r.status===404?new q(e):new Y(e,{cause:r})}return s}};var He=class{#e;constructor({fetch:e=fetch}={}){this.#e=e}async resolve(e,n){if(!e.startsWith("did:web:"))throw new C(e);let s;try{let r=Gt(e),o=await(0,this.#e)(r,{signal:n?.signal,cache:n?.noCache?"no-cache":void 0,redirect:"manual",headers:{accept:"application/did+ld+json,application/json"}});if(o.status>=300&&o.status<400)throw new TypeError("unexpected redirect");s=(await Pe(o)).json}catch(r){throw r instanceof S&&r.status===404?new q(e):new Y(e,{cause:r})}return s}};var Fe=class{#e;strategy;constructor({methods:e,strategy:n="race"}){this.#e=e,this.strategy=n}async resolve(e,n){let{http:s,dns:r}=this.#e,o=n?.signal,i=new AbortController;o&&o.addEventListener("abort",()=>i.abort(),{signal:i.signal});let a=r.resolve(e,{...n,signal:i.signal}),p=s.resolve(e,{...n,signal:i.signal});switch(this.strategy){case"race":return new Promise(c=>{a.then(d=>{i.abort(),c(d)},()=>c(p)),p.then(d=>{i.abort(),c(d)},()=>c(a))});case"dns-first":{p.catch(ze);let c=await a.catch(ze);return c?(i.abort(),c):p}case"http-first":{a.catch(ze);let c=await p.catch(ze);return c?(i.abort(),c):a}case"both":{let[c,d]=await Promise.allSettled([a,p]),l=c.status==="fulfilled"?c.value:void 0,h=d.status==="fulfilled"?d.value:void 0;if(l&&h&&l!==h)throw new te(e);return l||h||a}}}},ze=()=>{};var Be=jt().assert(t=>Number.isInteger(t)&&t>=0&&t<=2**32-1),Ln=U({name:_(),type:et(16)}),Rn=U({name:_(),type:et(16),TTL:Be,data:_().chain(t=>D(t.replace(/^"|"$/g,"").replace(/\\"/g,'"')))}),Sn=U({name:_(),type:Be,TTL:Be,data:_()}),In=U({Status:Be,TC:X(),RD:X(),RA:X(),AD:X(),CD:X(),Question:Mt([Ln]),Answer:k(Rn).optional(()=>[]),Authority:k(Sn).optional(),Comment:_().optional()}),Dn="_atproto",nt="did=",Un=re(oe,Me(/^application\/(dns-)?json$/,16*1024),Ne(In,{mode:"passthrough"})),Je=class{dohUrl;#e;constructor({dohUrl:e,fetch:n=fetch}){this.dohUrl=e,this.#e=n}async resolve(e,n){let s;try{let i=new URL(this.dohUrl);i.searchParams.set("name",`${Dn}.${e}`),i.searchParams.set("type","TXT");let a=await(0,this.#e)(i,{signal:n?.signal,cache:n?.noCache?"no-cache":void 0,headers:{accept:"application/dns-json"}});s=(await Un(a)).json}catch(i){throw new z(e,{cause:i})}let r=s.Status,o=s.Answer;if(r!==0)throw r===3?new H(e):new z(e,{cause:new TypeError(`dns returned ${r}`)});for(let i=0,a=o.length;i<a;i++){let c=o[i].data;if(!c.startsWith(nt))continue;for(let l=i+1;l<a;l++)if(o[l].data.startsWith(nt))throw new te(e);let d=c.slice(nt.length);if(!Se(d))throw new ee(e,d);return d}throw new H(e)}};var Cn=re(oe,Kt(2064)),Ge=class{#e;constructor({fetch:e=fetch}={}){this.#e=e}async resolve(e,n){let s;try{let o=new URL("/.well-known/atproto-did",`https://${e}`),i=await(0,this.#e)(o,{signal:n?.signal,cache:n?.noCache?"no-cache":void 0,redirect:"manual"});if(i.status>=300&&i.status<400)throw new TypeError("unexpected redirect");s=(await Cn(i)).text}catch(o){throw o instanceof S&&o.status===404?new H(e):new z(e,{cause:o})}let r=s.split(`
`)[0].trim();if(!Se(r))throw new ee(e,r);return r}};var Fs=new Fe({strategy:"race",methods:{dns:new Je({dohUrl:"https://mozilla.cloudflare-dns.com/dns-query"}),http:new Ge}}),Bs=new Ce({methods:{plc:new Oe,web:new He}}),$n=We({service:"https://public.api.zeppelin.social"}),Zt=new ae({handler:$n});var jn="did:plc:jlplwn5pi4dqrls7i6dx2me7",st=class extends N{constructor(e){super();let n=e.record;this.with(new V().with(new Ie(e.author.avatar??"/media/default-avatar.png").class("Avatar"),new P().with(e.author.displayName??e.author.handle,n.text,new V().with(`\u{1F5E8}\uFE0F ${e.replyCount} `,`\u{1F501} ${e.repostCount} `,`\u{1F503} ${e.quoteCount} `,`\u2764\uFE0F ${e.likeCount} `)))),this.wraps.classList.add("PostView")}};async function Mn(){let t=new De,e=new pe("text");e.placeholder="Handle";let n=new pe("password");n.placeholder="Password";let s=new P().with("log in here",e,n,new V().with(new O("cancel",()=>{t.hide()}),new O("log in",()=>{})));t.add(s).show()}var rt=class extends N{constructor(e){super(),this.wraps.classList.add("AccountPanel");let n=localStorage.getItem("atp-session");if(n){let s=JSON.parse(n);this.with(new Z(`Logged in as ${s.handle}`),new O("Log out",()=>{localStorage.removeItem("atp-session"),window.location.reload()}))}else this.add(new O("Log in",()=>{Mn()}))}};async function Nn(){let t=new P().class("PostsColumn"),e=new P().with(new rt(Zt),new Z("who up skeeting they deck"),t);Ue.add(e);let s=(await ge(Zt.get("app.bsky.feed.getAuthorFeed",{params:{actor:jn}}))).feed.map(r=>new st(r.post));t.with(...s)}Nn();})();
