var qt=Object.create;var Ze=Object.defineProperty;var Qt=Object.getOwnPropertyDescriptor;var er=Object.getOwnPropertyNames;var tr=Object.getPrototypeOf,rr=Object.prototype.hasOwnProperty;var nr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),sr=(t,e)=>{for(var r in e)Ze(t,r,{get:e[r],enumerable:!0})},Fe=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of er(e))!rr.call(t,s)&&s!==r&&Ze(t,s,{get:()=>e[s],enumerable:!(n=Qt(e,s))||n.enumerable});return t},st=(t,e,r)=>(Fe(t,e,"default"),r&&Fe(r,e,"default")),or=(t,e,r)=>(r=t!=null?qt(tr(t)):{},Fe(e||!t||!t.__esModule?Ze(r,"default",{value:t,enumerable:!0}):r,t));var Nt=nr(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.lazy=m.union=m.tuple=m.array=m.record=m.object=m.literal=m.undefined=m.null=m.boolean=m.bigint=m.number=m.string=m.never=m.unknown=m.ValitaError=void 0;m.ok=Qe;m.err=fr;function U(t){return{ok:!1,code:"invalid_type",expected:t}}var Ye=U([]),dt=U(["string"]),lt=U(["number"]),ut=U(["bigint"]),ft=U(["boolean"]),ht=U(["undefined"]),pt=U(["null"]),dr=U(["object"]),lr=U(["array"]),qe={ok:!1,code:"missing_value"};function X(t,e){return t?{ok:!1,code:"join",left:t,right:e}:e}function V(t,e){return{ok:!1,code:"prepend",key:t,tree:e}}function ur(t,e){let r=t.code;switch(r){case"invalid_type":return{code:r,path:e,expected:t.expected};case"invalid_literal":return{code:r,path:e,expected:t.expected};case"missing_value":return{code:r,path:e};case"invalid_length":return{code:r,path:e,minLength:t.minLength,maxLength:t.maxLength};case"unrecognized_keys":return{code:r,path:e,keys:t.keys};case"invalid_union":return{code:r,path:e,tree:t.tree,issues:ke(t.tree)};case"custom_error":return typeof t.error=="object"&&t.error.path!==void 0&&e.push(...t.error.path),{code:r,path:e,message:typeof t.error=="string"?t.error:t.error?.message,error:t.error}}}function ke(t,e=[],r=[]){for(;;)if(t.code==="join")ke(t.left,e.slice(),r),t=t.right;else if(t.code==="prepend")e.push(t.key),t=t.tree;else return r.push(ur(t,e)),r}function He(t,e){return t.length===0?"nothing":t.length===1?t[0]:`${t.slice(0,-1).join(", ")} ${e} ${t[t.length-1]}`}function ct(t){return typeof t=="bigint"?`${t}n`:JSON.stringify(t)}function mt(t){let e=0;for(;;)if(t.code==="join")e+=mt(t.left),t=t.right;else if(t.code==="prepend")t=t.tree;else return e+1}function wt(t){let e="",r=0;for(;;)if(t.code==="join")r+=mt(t.right),t=t.left;else if(t.code==="prepend")e+=`.${t.key}`,t=t.tree;else break;let n="validation failed";if(t.code==="invalid_type")n=`expected ${He(t.expected,"or")}`;else if(t.code==="invalid_literal")n=`expected ${He(t.expected.map(ct),"or")}`;else if(t.code==="missing_value")n="missing value";else if(t.code==="unrecognized_keys"){let o=t.keys;n=`unrecognized ${o.length===1?"key":"keys"} ${He(o.map(ct),"and")}`}else if(t.code==="invalid_length"){let o=t.minLength,d=t.maxLength;n="expected an array with ",o>0?d===o?n+=`${o}`:d!==void 0?n+=`between ${o} and ${d}`:n+=`at least ${o}`:n+=`at most ${d??"\u221E"}`,n+=" item(s)"}else if(t.code==="custom_error"){let o=t.error;typeof o=="string"?n=o:o!==void 0&&(o.message!==void 0&&(n=o.message),o.path!==void 0&&(e+="."+o.path.join(".")))}let s=`${t.code} at .${e.slice(1)} (${n})`;return r===1?s+=" (+ 1 other issue)":r>1&&(s+=` (+ ${r} other issues)`),s}function T(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:n,writable:!1}),r}var de=class extends Error{constructor(e){super(wt(e)),Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name,this._issueTree=e}get issues(){return T(this,"issues",ke(this._issueTree),!0)}};m.ValitaError=de;var ye=class{constructor(e){this.ok=!1,this._issueTree=e}get issues(){return T(this,"issues",ke(this._issueTree),!0)}get message(){return T(this,"message",wt(this._issueTree),!0)}throw(){throw new de(this._issueTree)}};function Qe(t){return{ok:!0,value:t}}function fr(t){return new ye({ok:!1,code:"custom_error",error:t})}function gt(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var M=1,le=2,be=4,yt=0,xt=1,vt=2,Et=3,_t=4,kt=5,bt=6,At=7,Tt=8,Rt=9,Lt=10,Dt=11,St=12,It=13,Ut=14,hr=15,L=(t,e)=>({tag:t,match:e});function k(t,e,r){switch(t.tag){case yt:return;case xt:return Ye;case vt:return typeof e=="string"?void 0:dt;case Et:return typeof e=="number"?void 0:lt;case _t:return typeof e=="bigint"?void 0:ut;case kt:return typeof e=="boolean"?void 0:ft;case bt:return e===null?void 0:pt;case At:return e===void 0?void 0:ht;case Tt:return t.match(e,r);case Rt:return t.match(e,r);case Lt:return t.match(e,r);case Dt:return t.match(e,r);case St:return t.match(e,r);case It:return t.match(e,r);case Ut:return t.match(e,r);default:return t.match(e,r)}}var w=Symbol.for("@valita/internal"),xe=class{default(e){let r=Qe(e);return new R(this.optional(),n=>n===void 0?r:void 0)}assert(e,r){let n={ok:!1,code:"custom_error",error:r};return new R(this,(s,o)=>e(s,Ge(o))?void 0:n)}map(e){return new R(this,(r,n)=>({ok:!0,value:e(r,Ge(n))}))}chain(e){return typeof e=="function"?new R(this,(r,n)=>{let s=e(r,Ge(n));return s.ok?s:s._issueTree}):new R(this,(r,n)=>k(e[w],r,n))}},D=class extends xe{optional(e){let r=new We(this);return e?new R(r,n=>n===void 0?{ok:!0,value:e()}:void 0):r}nullable(e){let r=new Je([Ct(),this]);return e?new R(r,n=>n===null?{ok:!0,value:e()}:void 0):r}_toTerminals(e){e(this)}try(e,r){let n=k(this[w],e,r===void 0?M:r.mode==="strip"?le:r.mode==="passthrough"?0:M);return n===void 0||n.ok?{ok:!0,value:n===void 0?e:n.value}:new ye(n)}parse(e,r){let n=k(this[w],e,r===void 0?M:r.mode==="strip"?le:r.mode==="passthrough"?0:M);if(n===void 0||n.ok)return n===void 0?e:n.value;throw new de(n)}},Je=class extends D{constructor(e){super(),this.name="union",this.options=e}get[w](){let e=this.options.map(r=>r[w]);return T(this,w,L(It,(r,n)=>{let s=Ye;for(let o of e){let d=k(o,r,n);if(d===void 0||d.ok)return d;s=d}return s}),!1)}_toTerminals(e){for(let r of this.options)r._toTerminals(e)}},We=class extends xe{constructor(e){super(),this.name="optional",this.type=e}optional(e){return e?new R(this,r=>r===void 0?{ok:!0,value:e()}:void 0):this}get[w](){let e=this.type[w];return T(this,w,L(Rt,(r,n)=>r===void 0||n&be?void 0:k(e,r,n)),!1)}_toTerminals(e){e(this),e(jt()),this.type._toTerminals(e)}};function $t(t,e){if(typeof t!="number"){let r=e>>5;for(let n=t.length;n<=r;n++)t.push(0);return t[r]|=1<<e%32,t}else return e<32?t|1<<e:$t([t,0],e)}function ae(t,e){return typeof t=="number"?e<32?t>>>e&1:0:t[e>>5]>>>e%32&1}var ve=class t extends D{constructor(e,r,n){super(),this.name="object",this.shape=e,this._restType=r,this._checks=n}get[w](){let e=pr(this.shape,this._restType,this._checks);return T(this,w,L(Lt,(r,n)=>gt(r)?e(r,n):dr),!1)}check(e,r){let n={ok:!1,code:"custom_error",error:r};return new t(this.shape,this._restType,[...this._checks??[],{func:e,issue:n}])}rest(e){return new t(this.shape,e)}extend(e){return new t({...this.shape,...e},this._restType)}pick(...e){let r={};for(let n of e)b(r,n,this.shape[n]);return new t(r,void 0)}omit(...e){let r={...this.shape};for(let n of e)delete r[n];return new t(r,this._restType)}partial(){let e={};for(let n of Object.keys(this.shape))b(e,n,this.shape[n].optional());let r=this._restType?.optional();return new t(e,r)}};function b(t,e,r){e==="__proto__"?Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0}):t[e]=r}function pr(t,e,r){let n=Object.keys(t).map((a,u)=>{let c=t[a],l=!1;return c._toTerminals(h=>{l||=h.name==="optional"}),{key:a,index:u,matcher:c[w],optional:l,missing:V(a,qe)}}),s=Object.create(null);for(let a of n)s[a.key]=a;let o=e?.[w],d=n.length===0&&e?.name==="unknown"&&r===void 0;return(a,u)=>{if(d)return;let c,l,h,g=0,p=0;if(u&(M|le)||o!==void 0)for(let f in a){let y=a[f],x=s[f];if(x===void 0&&o===void 0){if(u&M)h===void 0?(h=[f],l=X(l,{ok:!1,code:"unrecognized_keys",keys:h})):h.push(f);else if(u&le&&l===void 0&&c===void 0){c={};for(let E=0;E<n.length;E++)if(ae(g,E)){let v=n[E].key;b(c,v,a[v])}}continue}let _=k(x===void 0?o:x.matcher,y,u);if(_===void 0)c!==void 0&&l===void 0&&b(c,f,y);else if(!_.ok)l=X(l,V(f,_));else if(l===void 0){if(c===void 0)if(c={},o===void 0){for(let E=0;E<n.length;E++)if(ae(g,E)){let v=n[E].key;b(c,v,a[v])}}else for(let E in a)b(c,E,a[E]);b(c,f,_.value)}x!==void 0&&(p++,g=$t(g,x.index))}if(p<n.length)for(let f=0;f<n.length;f++){if(ae(g,f))continue;let y=n[f],x=a[y.key],_=0;if(x===void 0&&!(y.key in a)){if(!y.optional){l=X(l,y.missing);continue}_=be}let E=k(y.matcher,x,u|_);if(E===void 0)c!==void 0&&l===void 0&&!_&&b(c,y.key,x);else if(!E.ok)l=X(l,V(y.key,E));else if(l===void 0){if(c===void 0)if(c={},o===void 0){for(let v=0;v<n.length;v++)if(v<f||ae(g,v)){let oe=n[v].key;b(c,oe,a[oe])}}else{for(let v in a)b(c,v,a[v]);for(let v=0;v<f;v++)if(!ae(g,v)){let oe=n[v].key;b(c,oe,a[oe])}}b(c,y.key,E.value)}}if(l!==void 0)return l;if(r!==void 0){for(let{func:f,issue:y}of r)if(!f(c??a))return y}return c&&{ok:!0,value:c}}}var Ee=class t extends D{constructor(e,r,n){super(),this.name="array",this._prefix=e,this._rest=r,this._suffix=n}get[w](){let e=this._prefix.map(a=>a[w]),r=this._suffix.map(a=>a[w]),n=this._rest?.[w]??L(1,()=>qe),s=e.length+r.length,o=this._rest?1/0:s,d={ok:!1,code:"invalid_length",minLength:s,maxLength:o===1/0?void 0:o};return T(this,w,L(Dt,(a,u)=>{if(!Array.isArray(a))return lr;let c=a.length;if(c<s||c>o)return d;let l=e.length,h=a.length-r.length,g,p=a;for(let f=0;f<a.length;f++){let y=f<l?e[f]:f>=h?r[f-h]:n,x=k(y,a[f],u);x!==void 0&&(x.ok?(p===a&&(p=a.slice()),p[f]=x.value):g=X(g,V(f,x)))}return g||(a===p?void 0:{ok:!0,value:p})}),!1)}concat(e){if(this._rest){if(e._rest)throw new TypeError("can not concatenate two variadic types");return new t(this._prefix,this._rest,[...this._suffix,...e._prefix,...e._suffix])}else return e._rest?new t([...this._prefix,...this._suffix,...e._prefix],e._rest,e._suffix):new t([...this._prefix,...this._suffix,...e._prefix,...e._suffix],e._rest,e._suffix)}};function _e(t){let e=typeof t;return e!=="object"?e:t===null?"null":Array.isArray(t)?"array":e}function ce(t){return[...new Set(t)]}function zt(t){let e=new Map,r=new Map,n=new Map,s=[],o=[],d=[];for(let{root:u,terminal:c}of t)if(e.set(u,e.get(u)??e.size),c.name!=="never")if(c.name==="optional")o.push(u);else if(c.name==="unknown")s.push(u);else if(c.name==="literal"){let l=r.get(c.value)??[];l.push(u),r.set(c.value,l),d.push(_e(c.value))}else{let l=n.get(c.name)??[];l.push(u),n.set(c.name,l),d.push(c.name)}let a=(u,c)=>(e.get(u)??0)-(e.get(c)??0);for(let[u,c]of r){let l=n.get(_e(u));l?(l.push(...c),r.delete(u)):r.set(u,ce(c.concat(s)).sort(a))}for(let[u,c]of n)n.set(u,ce(c.concat(s)).sort(a));return{types:n,literals:r,unknowns:ce(s).sort(a),optionals:ce(o).sort(a),expectedTypes:ce(d)}}function mr(t,e){let r=[];for(let{root:p,terminal:f}of t)f.shape[e]._toTerminals(y=>r.push({root:p,terminal:y}));let{types:n,literals:s,optionals:o,unknowns:d,expectedTypes:a}=zt(r);if(d.length>0||o.length>1)return;for(let p of s.values())if(p.length>1)return;for(let p of n.values())if(p.length>1)return;let u=V(e,qe),c=V(e,n.size===0?{ok:!1,code:"invalid_literal",expected:[...s.keys()]}:{ok:!1,code:"invalid_type",expected:a}),l=s.size>0?new Map:void 0;if(l)for(let[p,f]of s)l.set(p,f[0][w]);let h=n.size>0?{}:void 0;if(h)for(let[p,f]of n)h[p]=f[0][w];let g=o[0]?.[w];return(p,f)=>{let y=p[e];if(y===void 0&&!(e in p))return g===void 0?u:k(g,p,f);let x=h?.[_e(y)]??l?.get(y);return x?k(x,p,f):c}}function wr(t){let e=[],r=new Map;for(let{root:n,terminal:s}of t){if(s.name==="unknown")return;if(s.name==="object"){for(let o in s.shape)r.set(o,(r.get(o)??0)+1);e.push({root:n,terminal:s})}}if(!(e.length<2)){for(let[n,s]of r)if(s===e.length){let o=mr(e,n);if(o)return o}}}function gr(t){let{expectedTypes:e,literals:r,types:n,unknowns:s,optionals:o}=zt(t),d=n.size===0&&s.length===0?{ok:!1,code:"invalid_literal",expected:[...r.keys()]}:{ok:!1,code:"invalid_type",expected:e},a=r.size>0?new Map:void 0;if(a)for(let[h,g]of r)a.set(h,g.map(p=>p[w]));let u=n.size>0?{}:void 0;if(u)for(let[h,g]of n)u[h]=g.map(p=>p[w]);let c=o.map(h=>h[w]),l=s.map(h=>h[w]);return(h,g)=>{let p=g&be?c:u?.[_e(h)]??a?.get(h)??l,f=0,y=d;for(let x=0;x<p.length;x++){let _=k(p[x],h,g);if(_===void 0||_.ok)return _;y=f>0?X(y,_):_,f++}return f>1?{ok:!1,code:"invalid_union",tree:y}:y}}var Ke=class extends D{constructor(e){super(),this.name="union",this.options=e}_toTerminals(e){for(let r of this.options)r._toTerminals(e)}get[w](){let e=[];for(let s of this.options)s._toTerminals(o=>{e.push({root:s,terminal:o})});let r=gr(e),n=wr(e);return T(this,w,L(St,(s,o)=>n!==void 0&&gt(s)?n(s,o):r(s,o)),!1)}},yr=Object.freeze({mode:"strict"}),xr=Object.freeze({mode:"strip"}),vr=Object.freeze({mode:"passthrough"});function Ge(t){return t&M?yr:t&le?xr:vr}var R=class t extends D{constructor(e,r){super(),this.name="transform",this._transformed=e,this._transform=r}get[w](){let e=[],r=this;for(;r instanceof t;)e.push(r._transform),r=r._transformed;e.reverse();let n=r[w],s=Qe(void 0);return T(this,w,L(Ut,(o,d)=>{let a=k(n,o,d);if(a!==void 0&&!a.ok)return a;let u;a!==void 0?u=a.value:d&be?(u=void 0,a=s):u=o;for(let c=0;c<e.length;c++){let l=e[c](u,d);if(l!==void 0){if(!l.ok)return l;u=l.value,a=l}}return a}),!1)}_toTerminals(e){this._transformed._toTerminals(e)}},Xe=class extends D{constructor(e){super(),this.name="lazy",this._recursing=!1,this._definer=e}get type(){return T(this,"type",this._definer(),!0)}get[w](){let e=L(hr,(r,n)=>{let s=this.type[w];return e.tag=s.tag,e.match=s.match,T(this,w,s,!1),k(s,r,n)});return e}_toTerminals(e){if(!this._recursing){this._recursing=!0;try{this.type._toTerminals(e)}finally{this._recursing=!1}}}};function $(t,e,r){let n=L(e,r);class s extends D{constructor(){super(),this.name=t,this[w]=n}}let o=new s;return()=>o}m.unknown=$("unknown",yt,()=>{});m.never=$("never",xt,()=>Ye);m.string=$("string",vt,t=>typeof t=="string"?void 0:dt);m.number=$("number",Et,t=>typeof t=="number"?void 0:lt);m.bigint=$("bigint",_t,t=>typeof t=="bigint"?void 0:ut);m.boolean=$("boolean",kt,t=>typeof t=="boolean"?void 0:ft);var Ct=$("null",bt,t=>t===null?void 0:pt);m.null=Ct;var jt=$("undefined",At,t=>t===void 0?void 0:ht);m.undefined=jt;var Ve=class extends D{constructor(e){super(),this.name="literal";let r={ok:!1,code:"invalid_literal",expected:[e]};this[w]=L(Tt,n=>n===e?void 0:r),this.value=e}},Er=t=>new Ve(t);m.literal=Er;var _r=t=>new ve(t,void 0);m.object=_r;var kr=t=>new ve({},t??(0,m.unknown)());m.record=kr;var br=t=>new Ee([],t??(0,m.unknown)(),[]);m.array=br;var Ar=t=>new Ee(t,void 0,[]);m.tuple=Ar;var Tr=(...t)=>new Ke(t);m.union=Tr;var Rr=t=>new Xe(t);m.lazy=Rr});var ot=t=>typeof t=="object"?t.handle.bind(t):t,Be=({service:t,fetch:e=fetch})=>async(r,n)=>{let s=new URL(r,t);return await e(s,n)};var it=/\bapplication\/json\b/,ie=class t{constructor({handler:e,proxy:r=null}){this.handler=ot(e),this.proxy=r}clone({handler:e=this.handler,proxy:r=this.proxy}={}){return new t({handler:e,proxy:r})}get(e,r={}){return this.#e("get",e,r)}post(e,r={}){return this.#e("post",e,r)}async#e(e,r,{signal:n,as:s="json",headers:o,input:d,params:a}){let u=d&&(d instanceof Blob||ArrayBuffer.isView(d)||d instanceof ArrayBuffer||d instanceof ReadableStream),c=`/xrpc/${r}`+ir(a),l=await this.handler(c,{method:e,signal:n,body:d&&!u?JSON.stringify(d):d,headers:cr(o,{"content-type":d&&!u?"application/json":null,"atproto-proxy":ar(this.proxy)})});{let h=l.status,g=l.headers,p=g.get("content-type");if(h!==200){let f;if(p!=null&&it.test(p))try{let y=await l.json();at(y)&&(f=y)}catch{}else await l.body?.cancel();return{ok:!1,status:h,headers:g,data:f??{error:"UnknownXRPCError",message:`Request failed with status code ${h}`}}}{let f;switch(s){case"json":{if(p!=null&&it.test(p))f=await l.json();else throw await l.body?.cancel(),new TypeError(`Invalid response content-type (got ${p})`);break}case null:{if(f=null,await l.body?.cancel(),p!=null)throw new TypeError(`Invalid response content-type (got ${p})`);break}case"blob":{f=await l.blob();break}case"bytes":{f=new Uint8Array(await l.arrayBuffer());break}case"stream":{f=l.body;break}}return{ok:!0,status:h,headers:g,data:f}}}}},ir=t=>{let e;for(let r in t){let n=t[r];if(n!==void 0)if(e??=new URLSearchParams,Array.isArray(n))for(let s=0,o=n.length;s<o;s++){let d=n[s];e.append(r,""+d)}else e.set(r,""+n)}return e?"?"+e.toString():""},ar=t=>t!=null?`${t.did}${t.serviceId}`:null,cr=(t,e)=>{let r;for(let n in e){let s=e[n];s!==null&&(r??=new Headers(t),r.has(n)||r.set(n,s))}return r??t},at=t=>{if(typeof t!="object"||t==null)return!1;let e=typeof t.error,r=typeof t.message;return e==="string"&&(r==="undefined"||r==="string")},ge=t=>{if(t instanceof Promise)return t.then(ge);if(t.ok)return t.data;throw new we(t)},we=class extends Error{constructor({status:e,headers:r=new Headers,data:n}){super(`${n.error} > ${n.message??"(unspecified description)"}`),this.name="ClientResponseError",this.error=n.error,this.description=n.message,this.status=e,this.headers=r}};var Y={};sr(Y,{FRAGMENT_RE:()=>Mt,MULTIBASE_RE:()=>Ft,didDocument:()=>Ir,didRelativeUri:()=>Te,didString:()=>ue,multibaseString:()=>Zt,rfc3968UriSchema:()=>F,service:()=>Bt,verificationMethod:()=>et});var i={};st(i,or(Nt(),1));var Lr=/^did:([a-z]+):([a-zA-Z0-9._:%\-]*[a-zA-Z0-9._\-])$/,Ae=t=>typeof t=="string"&&t.length>=7&&t.length<=2048&&Lr.test(t);var Pt=globalThis.process?.env?.NODE_ENV,Ot=Pt&&!Pt.toLowerCase().startsWith("prod");var In=new Intl.Segmenter;var Un=Array.isArray;var Mt=/^#[^#]+$/,Ft=/^z[a-km-zA-HJ-NP-Z1-9]+$/,F=i.string().assert(t=>URL.canParse(t),"must be a url"),Te=i.string().assert(t=>Mt.test(t)||URL.canParse(t),"must be a did relative uri"),Zt=i.string().assert(t=>Ft.test(t),"must be a base58 multibase"),ue=i.string().assert(Ae,"must be a did"),et=i.object({id:Te,type:i.string(),controller:ue,publicKeyMultibase:Zt.optional(),publicKeyJwk:i.record().optional()}).chain(t=>{switch(t.type){case"Multikey":{if(t.publicKeyMultibase===void 0)return i.err({message:"missing multikey",path:["publicKeyMultibase"]});break}case"EcdsaSecp256k1VerificationKey2019":case"EcdsaSecp256r1VerificationKey2019":{if(t.publicKeyMultibase===void 0)return i.err({message:"missing multibase key",path:["publicKeyMultibase"]});break}}return i.ok(t)}),Bt=i.object({id:Te,type:i.union(i.string(),i.array(i.string())),serviceEndpoint:i.union(F,i.record(F),i.array(i.union(F,i.record(F))))}),Ir=i.object({"@context":i.array(F),id:ue,alsoKnownAs:i.array(F).chain(t=>{for(let e=0,r=t.length;e<r;e++){let n=t[e];for(let s=0;s<e;s++)if(n===t[s])return i.err({message:`duplicate "${n}" aka entry`,path:[e]})}return i.ok(t)}).optional(),verificationMethod:i.array(et).chain(t=>{for(let e=0,r=t.length;e<r;e++){let s=t[e].id;for(let o=0;o<e;o++)if(s===t[o].id)return i.err({message:`duplicate "${s}" verification method`,path:[e,"id"]})}return i.ok(t)}).optional(),service:i.array(Bt).optional(),controller:i.union(ue,i.array(ue)).optional(),authentication:i.array(i.union(Te,et)).optional()}).chain(t=>{let{id:e,service:r}=t;if(r?.length){let n=r.length,s=new Array(n);for(let o=0;o<n;o++){let a=r[o].id;a[0]==="#"&&(a=e+a),s[o]=a}for(let o=0;o<n;o++){let d=s[o];for(let a=0;a<o;a++)if(d===s[a])return i.err({message:`duplicate "${d}" service`,path:["service",o,"id"]})}}return i.ok(t)});var Qn="parse"in URL;var Ur=/^did:plc:([a-z2-7]{24})$/,Ht=t=>t.length===32&&Ur.test(t);var $r=/^did:web:([a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*(?:\.[a-zA-Z]{2,})|localhost(?:%3[aA]\d+)?)$/;var Gt=t=>t.length>=12&&$r.test(t);var Jt=t=>{let[e,...r]=t.slice(8).split(":").map(decodeURIComponent),n="/"+r.join("/");n==="/"?n="/.well-known/did.json":n+="/did.json";let s=new URL(`https://${e}${n}`);return s.hostname==="localhost"&&(s.protocol="http:"),s};var q=t=>Ht(t)||Gt(t),Wt=t=>{let e=t.indexOf(":",4);return t.slice(4,e)};var zr=0,Z=class{wraps;children=[];id="L"+zr++;constructor(e){this.wraps=e,this.wraps.id=this.id}add(e){if(e!=null){let r;typeof e=="string"?r=new ee(e):r=e,this.children.push(r),this.wraps.appendChild(r.wraps)}else throw new Error("node undefined");return this}remove(e){let r=this.children.indexOf(e);if(r<0)throw new Error("node not a child of this node");this.children.splice(r,1),this.wraps.removeChild(e.wraps)}with(...e){return e.forEach(r=>{this.add(r)}),this}style(e){return e(this.wraps.style),this}class(e){return this.wraps.classList.add(e),this}};var B=class extends Z{constructor(){let e=document.createElement("div");e.classList.add("LContainer"),super(e)}},H=class extends B{constructor(){super(),this.wraps.classList.add("LColumn")}},Q=class extends B{constructor(){super(),this.wraps.classList.add("LRow")}};var fe=class extends Z{_text="";get text(){return this._text}set text(e){this._text=e,this.wraps.textContent=e}},ee=class extends fe{constructor(e=""){let r=document.createElement("span");r.classList.add("LLabel"),super(r),this.text=e}},G=class extends fe{constructor(e,r){let n=document.createElement("button");n.textContent=e,n.addEventListener("click",r),n.classList.add("LButton"),super(n),this.text=e}},he=class extends fe{constructor(e="text"){let r=document.createElement("input");r.type=e,r.classList.add("LInput"),super(r)}set placeholder(e){this.wraps.placeholder=e}get value(){return this.wraps.value}set value(e){this.wraps.value=e,this.watching.forEach(r=>r(e))}watching=[];watch(e){this.watching.push(e),this.wraps.oninput=r=>{e(this.value)},e(this.value)}},Re=class extends Z{constructor(e){let r=document.createElement("img");r.src=e,r.classList.add("LImage"),super(r)}},Le=class extends Z{constructor(){let e=document.createElement("dialog");e.classList.add("LModal"),super(e)}show(){De.add(this),this.wraps.showModal()}hide(){this.wraps.close(),De.wraps.removeChild(this.wraps)}},De=new Z(document.body);var pe=class extends Error{name="DidResolutionError"},z=class extends pe{did;name="UnsupportedDidMethodError";constructor(e){super(`unsupported did method; did=${e}`),this.did=e}};var J=class extends pe{did;name="DocumentNotFoundError";constructor(e){super(`did document not found; did=${e}`),this.did=e}},W=class extends pe{did;name="FailedDocumentResolutionError";constructor(e,r){super(`failed to resolve did document; did=${e}`,r),this.did=e}},te=class extends Error{name="HandleResolutionError"},C=class extends te{handle;name="DidNotFoundError";constructor(e){super(`handle returned no did; handle=${e}`),this.handle=e}},j=class extends te{handle;name="FailedHandleResolutionError";constructor(e,r){super(`failed to resolve handle; handle=${e}`,r),this.handle=e}},re=class extends te{handle;did;name="InvalidResolvedHandleError";constructor(e,r){super(`handle returned invalid did; handle=${e}; did=${r}`),this.handle=e,this.did=r}},ne=class extends te{name="AmbiguousHandleError";constructor(e){super(`handle returned multiple did values; handle=${e}`)}};var Se=class{#e;constructor({methods:e}){this.#e=new Map(Object.entries(e))}async resolve(e,r){let n=Wt(e),s=this.#e.get(n);if(s===void 0)throw new z(e);return await s.resolve(e,r)}};var se=class extends Error{name="FetchResponseError"},A=class extends se{status;name="FailedResponseError";constructor(e,r){super(r),this.status=e}},me=class extends se{contentType;name="ImproperContentTypeError";constructor(e,r){super(r),this.contentType=e}},K=class extends se{expectedSize;actualSize;name="ImproperContentLengthError";constructor(e,r,n){super(n),this.expectedSize=e,this.actualSize=r}},Ie=class extends se{name="ImproperResponseError";constructor(e,r){super(e,r)}};function S(...t){return t.reduce(Cr)}var Cr=(t,e)=>r=>t(r).then(e);var Ue=class extends TransformStream{constructor(e){let r=0;super({transform(n,s){if(r+=n.length,r>e){s.error(new K(e,r,"response content-length too large"));return}s.enqueue(n)}})}};var I=async t=>{if(t.ok)return t;throw t.body&&await t.body.cancel(),new A(t.status,`got http ${t.status}`)},Xt=t=>async e=>{let r=await Vt(e,t);return{response:e,text:r}},P=(t,e)=>async r=>{jr(r,t);let n=await Vt(r,e);try{let s=JSON.parse(n);return{response:r,json:s}}catch(s){throw new Ie("unexpected json data",{cause:s})}},O=(t,e)=>async r=>{let n=t.parse(r.json,e);return{response:r.response,json:n}},jr=async(t,e)=>{let r=t.headers.get("content-type")?.split(";",1)[0].trim();if(r===void 0)throw t.body&&await t.body.cancel(),new me(null,"missing response content-type");if(!e.test(r))throw t.body&&await t.body.cancel(),new me(r,"unexpected response content-type")},Vt=async(t,e)=>{let r=t.headers.get("content-length");if(r!==null){let o=Number(r);if(!Number.isSafeInteger(o)||o<=0)throw t.body?.cancel(),new K(e,null,"invalid response content-length");if(o>e)throw t.body?.cancel(),new K(e,o,"response content-length too large")}let n=t.body.pipeThrough(new Ue(e)).pipeThrough(new TextDecoderStream),s="";for await(let o of Nr(n))s+=o;return s},Nr=Symbol.asyncIterator in ReadableStream.prototype?t=>t[Symbol.asyncIterator]():t=>{let e=t.getReader();return{[Symbol.asyncIterator](){return this},next(){return e.read()},async return(){return await e.cancel(),{done:!0,value:void 0}},async throw(r){return await e.cancel(r),{done:!0,value:void 0}}}};var $e=S(I,P(/^application\/(did\+ld\+)?json$/,20*1024),O(Y.didDocument,{mode:"passthrough"}));var ze=class{apiUrl;#e;constructor({apiUrl:e="https://plc.directory",fetch:r=fetch}={}){this.apiUrl=e,this.#e=r}async resolve(e,r){if(!e.startsWith("did:plc:"))throw new z(e);let n;try{let s=new URL(`/${encodeURIComponent(e)}`,this.apiUrl),o=await(0,this.#e)(s,{signal:r?.signal,cache:r?.noCache?"no-cache":void 0,redirect:"manual",headers:{accept:"application/did+ld+json,application/json"}});if(o.status>=300&&o.status<400)throw new TypeError("unexpected redirect");n=(await $e(o)).json}catch(s){throw s instanceof A&&s.status===404?new J(e):new W(e,{cause:s})}return n}};var Ce=class{#e;constructor({fetch:e=fetch}={}){this.#e=e}async resolve(e,r){if(!e.startsWith("did:web:"))throw new z(e);let n;try{let s=Jt(e),o=await(0,this.#e)(s,{signal:r?.signal,cache:r?.noCache?"no-cache":void 0,redirect:"manual",headers:{accept:"application/did+ld+json,application/json"}});if(o.status>=300&&o.status<400)throw new TypeError("unexpected redirect");n=(await $e(o)).json}catch(s){throw s instanceof A&&s.status===404?new J(e):new W(e,{cause:s})}return n}};var Ys=S(I,P(/^application\/json$/,20*1024+16),O(i.object({didDoc:Y.didDocument}),{mode:"passthrough"}));var Ne=class{#e;strategy;constructor({methods:e,strategy:r="race"}){this.#e=e,this.strategy=r}async resolve(e,r){let{http:n,dns:s}=this.#e,o=r?.signal,d=new AbortController;o&&o.addEventListener("abort",()=>d.abort(),{signal:d.signal});let a=s.resolve(e,{...r,signal:d.signal}),u=n.resolve(e,{...r,signal:d.signal});switch(this.strategy){case"race":return new Promise(c=>{a.then(l=>{d.abort(),c(l)},()=>c(u)),u.then(l=>{d.abort(),c(l)},()=>c(a))});case"dns-first":{u.catch(je);let c=await a.catch(je);return c?(d.abort(),c):u}case"http-first":{a.catch(je);let c=await u.catch(je);return c?(d.abort(),c):a}case"both":{let[c,l]=await Promise.allSettled([a,u]),h=c.status==="fulfilled"?c.value:void 0,g=l.status==="fulfilled"?l.value:void 0;if(h&&g&&h!==g)throw new ne(e);return h||g||a}}}},je=()=>{};var Pe=i.number().assert(t=>Number.isInteger(t)&&t>=0&&t<=2**32-1),Pr=i.object({name:i.string(),type:i.literal(16)}),Or=i.object({name:i.string(),type:i.literal(16),TTL:Pe,data:i.string().chain(t=>i.ok(t.replace(/^"|"$/g,"").replace(/\\"/g,'"')))}),Mr=i.object({name:i.string(),type:Pe,TTL:Pe,data:i.string()}),Fr=i.object({Status:Pe,TC:i.boolean(),RD:i.boolean(),RA:i.boolean(),AD:i.boolean(),CD:i.boolean(),Question:i.tuple([Pr]),Answer:i.array(Or).optional(()=>[]),Authority:i.array(Mr).optional(),Comment:i.string().optional()}),Zr="_atproto",tt="did=",Br=S(I,P(/^application\/(dns-)?json$/,16*1024),O(Fr,{mode:"passthrough"})),Oe=class{dohUrl;#e;constructor({dohUrl:e,fetch:r=fetch}){this.dohUrl=e,this.#e=r}async resolve(e,r){let n;try{let d=new URL(this.dohUrl);d.searchParams.set("name",`${Zr}.${e}`),d.searchParams.set("type","TXT");let a=await(0,this.#e)(d,{signal:r?.signal,cache:r?.noCache?"no-cache":void 0,headers:{accept:"application/dns-json"}});n=(await Br(a)).json}catch(d){throw new j(e,{cause:d})}let s=n.Status,o=n.Answer;if(s!==0)throw s===3?new C(e):new j(e,{cause:new TypeError(`dns returned ${s}`)});for(let d=0,a=o.length;d<a;d++){let c=o[d].data;if(!c.startsWith(tt))continue;for(let h=d+1;h<a;h++)if(o[h].data.startsWith(tt))throw new ne(e);let l=c.slice(tt.length);if(!q(l))throw new re(e,l);return l}throw new C(e)}};var Hr=S(I,Xt(2064)),Me=class{#e;constructor({fetch:e=fetch}={}){this.#e=e}async resolve(e,r){let n;try{let o=new URL("/.well-known/atproto-did",`https://${e}`),d=await(0,this.#e)(o,{signal:r?.signal,cache:r?.noCache?"no-cache":void 0,redirect:"manual"});if(d.status>=300&&d.status<400)throw new TypeError("unexpected redirect");n=(await Hr(d)).text}catch(o){throw o instanceof A&&o.status===404?new C(e):new j(e,{cause:o})}let s=n.split(`
`)[0].trim();if(!q(s))throw new re(e,s);return s}};var Gr=i.object({did:i.string().assert(t=>q(t))}),co=S(I,P(/^application\/json$/,4*1024),O(Gr,{mode:"passthrough"}));var Ao=new Ne({strategy:"race",methods:{dns:new Oe({dohUrl:"https://mozilla.cloudflare-dns.com/dns-query"}),http:new Me}}),To=new Se({methods:{plc:new ze,web:new Ce}}),Jr=Be({service:"https://public.api.zeppelin.social"}),Yt=new ie({handler:Jr});var Wr="did:plc:jlplwn5pi4dqrls7i6dx2me7",rt=class extends B{constructor(e){super();let r=e.record;this.with(new Q().with(new Re(e.author.avatar??"/media/default-avatar.png").class("Avatar"),new H().with(e.author.displayName??e.author.handle,r.text,new Q().with(`\u{1F5E8}\uFE0F ${e.replyCount} `,`\u{1F501} ${e.repostCount} `,`\u{1F503} ${e.quoteCount} `,`\u2764\uFE0F ${e.likeCount} `)))),this.wraps.classList.add("PostView")}};async function Kr(){let t=new Le,e=new he("text");e.placeholder="Handle";let r=new he("password");r.placeholder="Password";let n=new H().with("log in here",e,r,new Q().with(new G("cancel",()=>{t.hide()}),new G("log in",()=>{})));t.add(n).show()}var nt=class extends B{constructor(e){super(),this.wraps.classList.add("AccountPanel");let r=localStorage.getItem("atp-session");if(r){let n=JSON.parse(r);this.with(new ee(`Logged in as ${n.handle}`),new G("Log out",()=>{localStorage.removeItem("atp-session"),window.location.reload()}))}else this.add(new G("Log in",()=>{Kr()}))}};async function Xr(){let t=new H().class("PostsColumn"),e=new H().with(new nt(Yt),new ee("who up skeeting they deck"),t);De.add(e);let n=(await ge(Yt.get("app.bsky.feed.getAuthorFeed",{params:{actor:Wr}}))).feed.map(s=>new rt(s.post));t.with(...n)}Xr();
